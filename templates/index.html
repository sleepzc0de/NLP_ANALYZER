<!doctype html>
<html lang="id" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NLP Analyzer ‚Äî Document Intelligence</title>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />

  <style type="text/tailwindcss">
    @theme {
      --color-primary:       #6366f1;
      --color-primary-light: #818cf8;
      --color-primary-dark:  #4f46e5;
      --color-accent:        #06b6d4;
      --color-surface:       #0f172a;
      --color-surface-2:     #1e293b;
      --color-surface-3:     #334155;
      --color-border:        #2d3748;
      --font-sans: 'Inter', system-ui, sans-serif;
      --font-mono: 'JetBrains Mono', monospace;
    }

    * { font-family: var(--font-sans); }

    .glass {
      background: rgba(30, 41, 59, 0.7);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid rgba(99, 102, 241, 0.15);
    }

    .glass-card {
      background: rgba(15, 23, 42, 0.8);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(99, 102, 241, 0.2);
    }

    .glow-primary {
      box-shadow: 0 0 30px rgba(99, 102, 241, 0.25),
                  0 0 60px rgba(99, 102, 241, 0.1);
    }

    .glow-accent {
      box-shadow: 0 0 20px rgba(6, 182, 212, 0.2);
    }

    .gradient-text {
      background: linear-gradient(135deg, #818cf8, #06b6d4);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .gradient-border {
      position: relative;
    }
    .gradient-border::before {
      content: '';
      position: absolute;
      inset: 0;
      padding: 1px;
      border-radius: inherit;
      background: linear-gradient(135deg, rgba(99,102,241,0.5), rgba(6,182,212,0.5));
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      pointer-events: none;
    }

    .upload-zone {
      background: radial-gradient(ellipse at center,
        rgba(99, 102, 241, 0.08) 0%,
        rgba(15, 23, 42, 0.6) 70%);
      transition: all 0.3s ease;
    }
    .upload-zone:hover,
    .upload-zone.drag-over {
      background: radial-gradient(ellipse at center,
        rgba(99, 102, 241, 0.18) 0%,
        rgba(15, 23, 42, 0.8) 70%);
      border-color: rgba(99, 102, 241, 0.6) !important;
      transform: scale(1.01);
    }

    .btn-primary {
      background: linear-gradient(135deg, #6366f1, #4f46e5);
      transition: all 0.25s ease;
      position: relative;
      overflow: hidden;
    }
    .btn-primary::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(255,255,255,0.1), transparent);
      opacity: 0;
      transition: opacity 0.25s;
    }
    .btn-primary:hover::after { opacity: 1; }
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
    }
    .btn-primary:active { transform: translateY(0); }

    .btn-accent {
      background: linear-gradient(135deg, #0891b2, #06b6d4);
      transition: all 0.25s ease;
    }
    .btn-accent:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 25px rgba(6, 182, 212, 0.35);
    }

    .btn-success {
      background: linear-gradient(135deg, #059669, #10b981);
      transition: all 0.25s ease;
    }
    .btn-success:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 25px rgba(16, 185, 129, 0.35);
    }

    .btn-warning {
      background: linear-gradient(135deg, #d97706, #f59e0b);
      transition: all 0.25s ease;
    }
    .btn-warning:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 25px rgba(245, 158, 11, 0.35);
    }

    .btn-ghost {
      background: rgba(99, 102, 241, 0.1);
      border: 1px solid rgba(99, 102, 241, 0.25);
      transition: all 0.25s ease;
    }
    .btn-ghost:hover {
      background: rgba(99, 102, 241, 0.2);
      border-color: rgba(99, 102, 241, 0.5);
    }

    .tag {
      display: inline-flex;
      align-items: center;
      padding: 3px 10px;
      border-radius: 9999px;
      font-size: 0.72rem;
      font-weight: 500;
      letter-spacing: 0.02em;
    }

    .progress-bar {
      height: 4px;
      border-radius: 9999px;
      background: rgba(99, 102, 241, 0.15);
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      border-radius: 9999px;
      background: linear-gradient(90deg, #6366f1, #06b6d4);
      transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .toast {
      transform: translateX(120%);
      transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .toast.show { transform: translateX(0); }

    .sidebar-item {
      transition: all 0.2s;
      cursor: pointer;
      border-left: 2px solid transparent;
    }
    .sidebar-item:hover {
      background: rgba(99, 102, 241, 0.1);
      border-left-color: rgba(99, 102, 241, 0.4);
    }
    .sidebar-item.active {
      background: rgba(99, 102, 241, 0.15);
      border-left-color: #6366f1;
    }

    .tab-btn {
      transition: all 0.2s;
      border-bottom: 2px solid transparent;
    }
    .tab-btn.active {
      color: #818cf8;
      border-bottom-color: #6366f1;
    }

    .step-indicator {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      font-weight: 600;
      transition: all 0.3s;
    }
    .step-indicator.completed {
      background: linear-gradient(135deg, #059669, #10b981);
      color: white;
    }
    .step-indicator.active {
      background: linear-gradient(135deg, #6366f1, #4f46e5);
      color: white;
      box-shadow: 0 0 15px rgba(99, 102, 241, 0.5);
    }
    .step-indicator.pending {
      background: rgba(51, 65, 85, 0.8);
      color: #64748b;
      border: 1px solid rgba(99, 102, 241, 0.2);
    }

    .entity-badge {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 3px 10px;
      border-radius: 6px;
      font-size: 0.72rem;
      font-weight: 500;
    }

    .sentiment-positive { color: #10b981; }
    .sentiment-negative { color: #f87171; }
    .sentiment-neutral  { color: #94a3b8; }

    .shimmer {
      background: linear-gradient(90deg,
        rgba(30,41,59,0.5) 0%,
        rgba(99,102,241,0.1) 50%,
        rgba(30,41,59,0.5) 100%);
      background-size: 200% 100%;
      animation: shimmer 1.6s infinite;
    }
    @keyframes shimmer {
      0%   { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    .fade-in {
      animation: fadeIn 0.4s ease forwards;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(12px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .pulse-dot {
      width: 8px; height: 8px; border-radius: 50%;
      background: #10b981;
      animation: pulseDot 2s infinite;
    }
    @keyframes pulseDot {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(0.8); }
    }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 5px; height: 5px; }
    ::-webkit-scrollbar-track { background: #0f172a; }
    ::-webkit-scrollbar-thumb { background: rgba(99,102,241,0.4); border-radius: 9999px; }
    ::-webkit-scrollbar-thumb:hover { background: rgba(99,102,241,0.7); }
  </style>
</head>

<body class="bg-[#060d1a] text-slate-200 min-h-screen overflow-x-hidden">

  <!-- Ambient Background -->
  <div class="fixed inset-0 pointer-events-none overflow-hidden" aria-hidden="true">
    <div class="absolute -top-40 -left-40 w-96 h-96 rounded-full bg-indigo-600/10 blur-[100px]"></div>
    <div class="absolute top-1/3 -right-32 w-80 h-80 rounded-full bg-cyan-500/8 blur-[80px]"></div>
    <div class="absolute bottom-0 left-1/3 w-72 h-72 rounded-full bg-violet-600/8 blur-[90px]"></div>
  </div>

  <!-- ‚îÄ‚îÄ NAVBAR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <nav class="fixed top-0 left-0 right-0 z-50 glass border-b border-indigo-500/10">
    <div class="max-w-screen-xl mx-auto px-6 h-16 flex items-center justify-between">
      <!-- Logo -->
      <div class="flex items-center gap-3">
        <div class="w-9 h-9 rounded-xl bg-gradient-to-br from-indigo-500 to-cyan-500 flex items-center justify-center shadow-lg">
          <svg class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
          </svg>
        </div>
        <div>
          <span class="font-bold text-white tracking-tight">NLP</span>
          <span class="font-light text-slate-400 ml-1">Analyzer</span>
        </div>
      </div>

      <!-- Nav Links -->
      <div class="hidden md:flex items-center gap-1">
        <button onclick="showView('upload')"
          class="nav-link px-4 py-2 rounded-lg text-sm text-slate-400 hover:text-white hover:bg-white/5 transition-all"
          data-view="upload">
          <span class="flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
            </svg>
            Upload
          </span>
        </button>
        <button onclick="showView('history')"
          class="nav-link px-4 py-2 rounded-lg text-sm text-slate-400 hover:text-white hover:bg-white/5 transition-all"
          data-view="history">
          <span class="flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
            </svg>
            Riwayat
          </span>
        </button>
      </div>

      <!-- Status Indicator -->
      <div class="flex items-center gap-2 text-xs text-slate-500">
        <div class="pulse-dot"></div>
        <span id="api-status">API Online</span>
      </div>
    </div>
  </nav>

  <!-- ‚îÄ‚îÄ MAIN CONTENT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <main class="pt-16 min-h-screen">

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         VIEW: UPLOAD
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="view-upload" class="view max-w-screen-xl mx-auto px-6 py-10">

      <!-- Header -->
      <div class="mb-10 text-center">
        <div class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-indigo-500/10 border border-indigo-500/20 text-indigo-300 text-xs font-medium mb-4">
          <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20">
            <path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z"/>
          </svg>
          Document Intelligence Platform
        </div>
        <h1 class="text-4xl md:text-5xl font-bold text-white mb-3 leading-tight">
          Analisis Dokumen<br>
          <span class="gradient-text">dengan AI & NLP</span>
        </h1>
        <p class="text-slate-400 text-lg max-w-xl mx-auto">
          Upload file PDF atau Word, ekstrak wawasan otomatis, dan kelola hasilnya dengan mudah.
        </p>
      </div>

      <!-- Step Indicator -->
      <div class="flex items-center justify-center gap-0 mb-10" id="steps-container">
        <!-- Step 1 -->
        <div class="flex items-center gap-3">
          <div class="step-indicator active" id="step-1">1</div>
          <span class="text-sm font-medium text-slate-300" id="step-1-label">Upload File</span>
        </div>
        <div class="w-16 h-px bg-slate-700 mx-4" id="line-1-2"></div>
        <!-- Step 2 -->
        <div class="flex items-center gap-3">
          <div class="step-indicator pending" id="step-2">2</div>
          <span class="text-sm text-slate-500" id="step-2-label">Analisis</span>
        </div>
        <div class="w-16 h-px bg-slate-700 mx-4" id="line-2-3"></div>
        <!-- Step 3 -->
        <div class="flex items-center gap-3">
          <div class="step-indicator pending" id="step-3">3</div>
          <span class="text-sm text-slate-500" id="step-3-label">Aksi</span>
        </div>
      </div>

      <!-- ‚îÄ‚îÄ PANEL: UPLOAD ‚îÄ‚îÄ -->
      <div id="panel-upload" class="max-w-2xl mx-auto fade-in">
        <div class="glass-card rounded-2xl p-8 gradient-border">
          <!-- Drop Zone -->
          <div id="drop-zone"
            class="upload-zone border-2 border-dashed border-indigo-500/30 rounded-xl p-12 text-center cursor-pointer mb-6"
            onclick="document.getElementById('file-input').click()"
            ondragover="handleDragOver(event)"
            ondragleave="handleDragLeave(event)"
            ondrop="handleDrop(event)">
            <div id="dz-idle">
              <div class="w-16 h-16 rounded-2xl bg-indigo-500/15 flex items-center justify-center mx-auto mb-4 border border-indigo-500/20">
                <svg class="w-8 h-8 text-indigo-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 16.5V9.75m0 0l3 3m-3-3l-3 3M6.75 19.5a4.5 4.5 0 01-1.41-8.775 5.25 5.25 0 0110.338-2.32 3.75 3.75 0 014.337 6.165"/>
                </svg>
              </div>
              <p class="text-white font-semibold mb-1">Drag & drop file ke sini</p>
              <p class="text-slate-400 text-sm">atau klik untuk memilih file</p>
              <div class="flex items-center justify-center gap-3 mt-4">
                <span class="tag bg-indigo-500/15 text-indigo-300 border border-indigo-500/20">PDF</span>
                <span class="tag bg-cyan-500/15 text-cyan-300 border border-cyan-500/20">DOCX</span>
                <span class="tag bg-violet-500/15 text-violet-300 border border-violet-500/20">DOC</span>
              </div>
              <p class="text-slate-600 text-xs mt-3">Maks. 16 MB</p>
            </div>
            <div id="dz-selected" class="hidden">
              <div class="w-14 h-14 rounded-xl bg-emerald-500/15 flex items-center justify-center mx-auto mb-3 border border-emerald-500/20">
                <svg class="w-7 h-7 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
              </div>
              <p class="text-white font-semibold" id="selected-filename">filename.pdf</p>
              <p class="text-slate-400 text-sm" id="selected-filesize">0 KB</p>
            </div>
          </div>
          <input id="file-input" type="file" accept=".pdf,.docx,.doc" class="hidden" onchange="handleFileSelect(this)" />

          <!-- Progress -->
          <div id="upload-progress" class="hidden mb-6">
            <div class="flex justify-between text-xs text-slate-400 mb-2">
              <span id="progress-label">Memproses...</span>
              <span id="progress-pct">0%</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" id="progress-fill" style="width:0%"></div>
            </div>
          </div>

          <!-- Action -->
          <button id="btn-analyze" onclick="analyzeDocument()"
            class="btn-primary w-full py-3.5 rounded-xl text-white font-semibold text-sm flex items-center justify-center gap-2 disabled:opacity-40 disabled:cursor-not-allowed disabled:transform-none"
            disabled>
            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/>
            </svg>
            Mulai Analisis
          </button>
        </div>
      </div>

      <!-- ‚îÄ‚îÄ PANEL: LOADING ‚îÄ‚îÄ -->
      <div id="panel-loading" class="max-w-2xl mx-auto hidden">
        <div class="glass-card rounded-2xl p-10 text-center gradient-border">
          <!-- Animated Icon -->
          <div class="relative w-20 h-20 mx-auto mb-6">
            <div class="absolute inset-0 rounded-full border-2 border-indigo-500/20 animate-spin" style="border-top-color:#6366f1; animation-duration:1.2s;"></div>
            <div class="absolute inset-2 rounded-full border-2 border-cyan-500/20 animate-spin" style="border-top-color:#06b6d4; animation-direction:reverse; animation-duration:0.9s;"></div>
            <div class="absolute inset-0 flex items-center justify-center">
              <svg class="w-7 h-7 text-indigo-400 animate-pulse" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 014.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3M14.25 3.104c.251.023.501.05.75.082M19.8 15.3l-1.57.393A9.065 9.065 0 0112 15a9.065 9.065 0 00-6.23-.693L5 14.5m14.8.8l1.402 1.402c1 1-.26 2.28-1.52 1.68l-1.683-.84M5 14.5l-1.402 1.402c-1 1 .26 2.28 1.52 1.68l1.683-.84"/>
              </svg>
            </div>
          </div>
          <h3 class="text-white font-semibold text-lg mb-2">Menganalisis Dokumen</h3>
          <p class="text-slate-400 text-sm mb-6" id="loading-step-text">Mengekstrak teks dari file...</p>
          <!-- Loading steps -->
          <div class="space-y-2 text-left max-w-xs mx-auto">
            <div class="loading-task flex items-center gap-3 text-sm" id="lt-extract">
              <div class="w-4 h-4 rounded-full border border-slate-600 flex items-center justify-center flex-shrink-0">
                <div class="w-2 h-2 rounded-full bg-slate-600" id="lt-extract-dot"></div>
              </div>
              <span class="text-slate-500" id="lt-extract-text">Ekstraksi teks</span>
            </div>
            <div class="loading-task flex items-center gap-3 text-sm" id="lt-nlp">
              <div class="w-4 h-4 rounded-full border border-slate-600 flex items-center justify-center flex-shrink-0">
                <div class="w-2 h-2 rounded-full bg-slate-600" id="lt-nlp-dot"></div>
              </div>
              <span class="text-slate-500" id="lt-nlp-text">Pemrosesan NLP</span>
            </div>
            <div class="loading-task flex items-center gap-3 text-sm" id="lt-entity">
              <div class="w-4 h-4 rounded-full border border-slate-600 flex items-center justify-center flex-shrink-0">
                <div class="w-2 h-2 rounded-full bg-slate-600" id="lt-entity-dot"></div>
              </div>
              <span class="text-slate-500" id="lt-entity-text">Named Entity Recognition</span>
            </div>
            <div class="loading-task flex items-center gap-3 text-sm" id="lt-sent">
              <div class="w-4 h-4 rounded-full border border-slate-600 flex items-center justify-center flex-shrink-0">
                <div class="w-2 h-2 rounded-full bg-slate-600" id="lt-sent-dot"></div>
              </div>
              <span class="text-slate-500" id="lt-sent-text">Analisis Sentimen</span>
            </div>
            <div class="loading-task flex items-center gap-3 text-sm" id="lt-summary">
              <div class="w-4 h-4 rounded-full border border-slate-600 flex items-center justify-center flex-shrink-0">
                <div class="w-2 h-2 rounded-full bg-slate-600" id="lt-summary-dot"></div>
              </div>
              <span class="text-slate-500" id="lt-summary-text">Generasi Ringkasan</span>
            </div>
          </div>
        </div>
      </div>

      <!-- ‚îÄ‚îÄ PANEL: RESULT ‚îÄ‚îÄ -->
      <div id="panel-result" class="hidden fade-in">
        <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">

          <!-- Left Column: Summary + Preview -->
          <div class="xl:col-span-2 space-y-5">

            <!-- Doc Info Header -->
            <div class="glass-card rounded-2xl p-6 gradient-border">
              <div class="flex items-start justify-between mb-4">
                <div class="flex items-center gap-4">
                  <div class="w-12 h-12 rounded-xl bg-indigo-500/15 flex items-center justify-center border border-indigo-500/20 flex-shrink-0">
                    <svg class="w-6 h-6 text-indigo-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"/>
                    </svg>
                  </div>
                  <div>
                    <h2 class="text-white font-semibold text-lg" id="res-filename">document.pdf</h2>
                    <div class="flex items-center gap-3 mt-1 flex-wrap">
                      <span class="tag bg-indigo-500/15 text-indigo-300 border border-indigo-500/20" id="res-filetype">PDF</span>
                      <span class="text-slate-500 text-xs" id="res-wordcount">0 kata</span>
                      <span class="text-slate-500 text-xs" id="res-charcount">0 karakter</span>
                      <span class="text-slate-500 text-xs" id="res-lang">üåê --</span>
                    </div>
                  </div>
                </div>
                <button onclick="resetUpload()" class="btn-ghost text-xs px-3 py-1.5 rounded-lg text-slate-400 hover:text-white flex items-center gap-1.5">
                  <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                  </svg>
                  Upload baru
                </button>
              </div>

              <!-- Tabs -->
              <div class="flex gap-6 border-b border-slate-700/50 mb-4">
                <button class="tab-btn active pb-3 text-sm font-medium" onclick="switchTab('summary', this)">Ringkasan</button>
                <button class="tab-btn pb-3 text-sm font-medium text-slate-500" onclick="switchTab('preview', this)">Pratinjau Teks</button>
              </div>

              <!-- Tab: Summary -->
              <div id="tab-summary">
                <p class="text-slate-300 text-sm leading-relaxed" id="res-summary">‚Äî</p>
              </div>

              <!-- Tab: Preview -->
              <div id="tab-preview" class="hidden">
                <div class="bg-slate-900/60 rounded-xl p-4 max-h-48 overflow-y-auto border border-slate-700/40">
                  <p class="text-slate-400 text-xs leading-relaxed font-mono" id="res-preview">‚Äî</p>
                </div>
              </div>
            </div>

            <!-- Sentiment + Topics -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">

              <!-- Sentiment -->
              <div class="glass-card rounded-2xl p-5 gradient-border">
                <h3 class="text-slate-300 text-sm font-semibold mb-4 flex items-center gap-2">
                  <svg class="w-4 h-4 text-indigo-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                  Sentimen
                </h3>
                <div class="flex items-center gap-4">
                  <div id="sentiment-icon" class="w-14 h-14 rounded-2xl bg-emerald-500/10 border border-emerald-500/20 flex items-center justify-center text-2xl">üòä</div>
                  <div>
                    <p class="text-white font-bold text-xl" id="res-sentiment-label">‚Äî</p>
                    <p class="text-slate-400 text-sm" id="res-sentiment-score">Confidence: ‚Äî</p>
                  </div>
                </div>
                <div class="mt-4 space-y-2">
                  <div class="flex justify-between text-xs text-slate-400">
                    <span>Positif</span><span id="res-pos-count">0</span>
                  </div>
                  <div class="progress-bar">
                    <div class="progress-fill" id="res-pos-bar" style="width:0%"></div>
                  </div>
                  <div class="flex justify-between text-xs text-slate-400">
                    <span>Negatif</span><span id="res-neg-count">0</span>
                  </div>
                  <div class="progress-bar" style="background:rgba(248,113,113,0.1);">
                    <div class="h-full rounded-full transition-all" id="res-neg-bar" style="width:0%; background:linear-gradient(90deg,#f87171,#ef4444);"></div>
                  </div>
                </div>
              </div>

              <!-- Topics -->
              <div class="glass-card rounded-2xl p-5 gradient-border">
                <h3 class="text-slate-300 text-sm font-semibold mb-4 flex items-center gap-2">
                  <svg class="w-4 h-4 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
                  </svg>
                  Topik Terdeteksi
                </h3>
                <div id="res-topics" class="flex flex-wrap gap-2">
                  <span class="text-slate-500 text-sm">‚Äî</span>
                </div>
                <div class="mt-4 pt-4 border-t border-slate-700/40">
                  <h4 class="text-slate-400 text-xs font-medium mb-2">Keyword Utama</h4>
                  <div id="res-keywords" class="flex flex-wrap gap-1.5">
                    <span class="text-slate-500 text-xs">‚Äî</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Entities -->
            <div class="glass-card rounded-2xl p-5 gradient-border">
              <h3 class="text-slate-300 text-sm font-semibold mb-4 flex items-center gap-2">
                <svg class="w-4 h-4 text-violet-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
                Named Entities
                <span id="res-entity-count" class="ml-auto tag bg-violet-500/15 text-violet-300 border border-violet-500/20">0</span>
              </h3>
              <div id="res-entities" class="flex flex-wrap gap-2">
                <span class="text-slate-500 text-sm">‚Äî</span>
              </div>
            </div>
          </div>

          <!-- Right Column: Action Panel -->
          <div class="space-y-5">

            <!-- Action Card -->
            <div class="glass-card rounded-2xl p-5 gradient-border sticky top-20">
              <h3 class="text-white font-semibold mb-1 flex items-center gap-2">
                <svg class="w-5 h-5 text-indigo-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                </svg>
                Pilih Aksi
              </h3>
              <p class="text-slate-400 text-xs mb-5">Pilih apa yang ingin dilakukan dengan hasil analisis ini.</p>

              <!-- Action Options -->
              <div class="space-y-3" id="action-options">
                <!-- Option 1: Save Only -->
                <label class="action-option-label block cursor-pointer">
                  <input type="radio" name="action" value="save" class="sr-only" onchange="selectAction('save')">
                  <div class="action-option glass rounded-xl p-4 border border-slate-700/50 hover:border-indigo-500/40 transition-all" id="opt-save">
                    <div class="flex items-start gap-3">
                      <div class="w-9 h-9 rounded-lg bg-emerald-500/10 border border-emerald-500/20 flex items-center justify-center flex-shrink-0 mt-0.5">
                        <svg class="w-4.5 h-4.5 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="width:18px;height:18px;">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M5 3a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2V7.414A2 2 0 0020.414 6L18 3.586A2 2 0 0016.586 3H5zm5 15v-5h4v5M9 3v4h6V3"/>
                        </svg>
                      </div>
                      <div>
                        <p class="text-white text-sm font-medium">Simpan ke Database</p>
                        <p class="text-slate-400 text-xs mt-0.5">Simpan dokumen & hasil analisis ke PostgreSQL.</p>
                      </div>
                    </div>
                  </div>
                </label>

                <!-- Option 2: Regenerate Only -->
                <label class="action-option-label block cursor-pointer">
                  <input type="radio" name="action" value="regen" class="sr-only" onchange="selectAction('regen')">
                  <div class="action-option glass rounded-xl p-4 border border-slate-700/50 hover:border-cyan-500/40 transition-all" id="opt-regen">
                    <div class="flex items-start gap-3">
                      <div class="w-9 h-9 rounded-lg bg-cyan-500/10 border border-cyan-500/20 flex items-center justify-center flex-shrink-0 mt-0.5">
                        <svg class="w-4.5 h-4.5 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="width:18px;height:18px;">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                      </div>
                      <div>
                        <p class="text-white text-sm font-medium">Generate Ulang</p>
                        <p class="text-slate-400 text-xs mt-0.5">Analisis ulang dengan konteks tambahan baru.</p>
                      </div>
                    </div>
                  </div>
                </label>

                <!-- Option 3: Save + Regenerate -->
                <label class="action-option-label block cursor-pointer">
                  <input type="radio" name="action" value="save-regen" class="sr-only" onchange="selectAction('save-regen')">
                  <div class="action-option glass rounded-xl p-4 border border-slate-700/50 hover:border-amber-500/40 transition-all" id="opt-save-regen">
                    <div class="flex items-start gap-3">
                      <div class="w-9 h-9 rounded-lg bg-amber-500/10 border border-amber-500/20 flex items-center justify-center flex-shrink-0 mt-0.5">
                        <svg class="w-4.5 h-4.5 text-amber-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="width:18px;height:18px;">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/>
                        </svg>
                      </div>
                      <div>
                        <p class="text-white text-sm font-medium">Simpan + Generate Ulang</p>
                        <p class="text-slate-400 text-xs mt-0.5">Simpan dulu, lalu tambah informasi baru.</p>
                      </div>
                    </div>
                  </div>
                </label>
              </div>

              <!-- Additional Context (shown for regen options) -->
              <div id="ctx-box" class="hidden mt-4">
                <label class="text-slate-400 text-xs font-medium block mb-2">Konteks Tambahan</label>
                <textarea id="additional-context" rows="4"
                  placeholder="Tambahkan informasi yang belum ada di dokumen..."
                  class="w-full bg-slate-900/70 border border-slate-700/50 focus:border-indigo-500/50 rounded-xl p-3 text-slate-200 text-sm placeholder-slate-600 resize-none outline-none transition-colors"></textarea>
              </div>

              <!-- Execute Button -->
              <button id="btn-execute" onclick="executeAction()"
                class="btn-primary w-full mt-4 py-3.5 rounded-xl text-white font-semibold text-sm flex items-center justify-center gap-2 disabled:opacity-30 disabled:cursor-not-allowed disabled:transform-none"
                disabled>
                <svg class="w-4 h-4" id="btn-execute-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                </svg>
                <span id="btn-execute-text">Pilih aksi terlebih dahulu</span>
              </button>

              <!-- Success State -->
              <div id="action-success" class="hidden mt-4 p-4 rounded-xl bg-emerald-500/10 border border-emerald-500/20">
                <div class="flex items-center gap-3">
                  <svg class="w-5 h-5 text-emerald-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                  <div>
                    <p class="text-emerald-300 text-sm font-medium" id="success-msg">Berhasil disimpan!</p>
                    <p class="text-slate-400 text-xs mt-0.5" id="success-detail">‚Äî</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Stats Mini Card -->
            <div class="glass-card rounded-2xl p-5 gradient-border">
              <h3 class="text-slate-400 text-xs font-semibold uppercase tracking-wider mb-4">Statistik Dokumen</h3>
              <div class="space-y-3">
                <div class="flex justify-between items-center">
                  <span class="text-slate-500 text-sm">Kata</span>
                  <span class="text-white text-sm font-medium font-mono" id="stat-words">‚Äî</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-slate-500 text-sm">Karakter</span>
                  <span class="text-white text-sm font-medium font-mono" id="stat-chars">‚Äî</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-slate-500 text-sm">Entitas</span>
                  <span class="text-white text-sm font-medium font-mono" id="stat-entities">‚Äî</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-slate-500 text-sm">Keyword</span>
                  <span class="text-white text-sm font-medium font-mono" id="stat-keywords">‚Äî</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-slate-500 text-sm">Bahasa</span>
                  <span class="text-white text-sm font-medium font-mono" id="stat-lang">‚Äî</span>
                </div>
              </div>
            </div>

          </div><!-- /Right Column -->
        </div><!-- /grid -->
      </div><!-- /panel-result -->

    </div><!-- /view-upload -->


    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         VIEW: HISTORY
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="view-history" class="view hidden max-w-screen-xl mx-auto px-6 py-10">
      <div class="mb-8 flex items-center justify-between">
        <div>
          <h2 class="text-3xl font-bold text-white mb-1">Riwayat Dokumen</h2>
          <p class="text-slate-400">Semua dokumen yang telah dianalisis & disimpan.</p>
        </div>
        <button onclick="loadHistory()" class="btn-ghost text-sm px-4 py-2 rounded-xl text-slate-300 flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
          </svg>
          Refresh
        </button>
      </div>

      <!-- Search -->
      <div class="relative mb-6">
        <svg class="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
        </svg>
        <input type="text" id="search-input" placeholder="Cari dokumen..."
          class="w-full bg-slate-800/50 border border-slate-700/50 focus:border-indigo-500/50 rounded-xl py-3 pl-11 pr-4 text-slate-200 placeholder-slate-500 text-sm outline-none transition-colors"
          oninput="filterHistory(this.value)" />
      </div>

      <!-- Table -->
      <div class="glass-card rounded-2xl overflow-hidden gradient-border">
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead>
              <tr class="border-b border-slate-700/50">
                <th class="text-left px-6 py-4 text-xs font-semibold text-slate-400 uppercase tracking-wider">Dokumen</th>
                <th class="text-left px-6 py-4 text-xs font-semibold text-slate-400 uppercase tracking-wider hidden sm:table-cell">Tipe</th>
                <th class="text-left px-6 py-4 text-xs font-semibold text-slate-400 uppercase tracking-wider hidden md:table-cell">Bahasa</th>
                <th class="text-left px-6 py-4 text-xs font-semibold text-slate-400 uppercase tracking-wider hidden lg:table-cell">Kata</th>
                <th class="text-left px-6 py-4 text-xs font-semibold text-slate-400 uppercase tracking-wider hidden lg:table-cell">Tanggal</th>
                <th class="text-right px-6 py-4 text-xs font-semibold text-slate-400 uppercase tracking-wider">Aksi</th>
              </tr>
            </thead>
            <tbody id="history-tbody">
              <tr>
                <td colspan="6" class="px-6 py-12 text-center text-slate-500">
                  <div class="flex flex-col items-center gap-3">
                    <svg class="w-10 h-10 text-slate-700" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
                    </svg>
                    <p>Klik Refresh untuk memuat data</p>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- Pagination -->
        <div class="px-6 py-4 border-t border-slate-700/40 flex items-center justify-between">
          <p class="text-slate-500 text-sm" id="history-info">‚Äî</p>
          <div class="flex gap-2">
            <button id="btn-prev" onclick="changePage(-1)"
              class="btn-ghost text-xs px-3 py-1.5 rounded-lg text-slate-400 disabled:opacity-30 disabled:cursor-not-allowed">
              ‚Üê Prev
            </button>
            <button id="btn-next" onclick="changePage(1)"
              class="btn-ghost text-xs px-3 py-1.5 rounded-lg text-slate-400 disabled:opacity-30 disabled:cursor-not-allowed">
              Next ‚Üí
            </button>
          </div>
        </div>
      </div>
    </div>

  </main>

  <!-- ‚îÄ‚îÄ TOAST NOTIFICATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div id="toast" class="toast fixed bottom-6 right-6 z-[100] max-w-sm">
    <div class="glass rounded-xl px-4 py-3 flex items-start gap-3 shadow-2xl">
      <div id="toast-icon" class="flex-shrink-0 mt-0.5">
        <svg class="w-5 h-5 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
      </div>
      <div>
        <p class="text-white text-sm font-medium" id="toast-title">‚Äî</p>
        <p class="text-slate-400 text-xs mt-0.5" id="toast-msg">‚Äî</p>
      </div>
      <button onclick="hideToast()" class="ml-2 text-slate-500 hover:text-white transition-colors flex-shrink-0">
        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ MODAL: DOCUMENT DETAIL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div id="modal-detail" class="fixed inset-0 z-50 hidden items-center justify-center p-4">
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeModal()"></div>
    <div class="relative glass-card rounded-2xl max-w-2xl w-full max-h-[80vh] overflow-y-auto gradient-border fade-in">
      <div class="p-6">
        <div class="flex items-center justify-between mb-5">
          <h3 class="text-white font-bold text-lg" id="modal-title">Detail Dokumen</h3>
          <button onclick="closeModal()" class="text-slate-500 hover:text-white transition-colors">
            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div id="modal-content" class="space-y-5 text-sm text-slate-300"></div>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ APP.JS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <script>
    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê STATE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    let state = {
      currentFile: null,
      analysisResult: null,
      rawText: null,
      selectedAction: null,
      historyPage: 1,
      historyTotal: 0,
      historyDocs: [],
    };

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê VIEW ROUTING ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    function showView(name) {
      document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
      document.getElementById(`view-${name}`).classList.remove('hidden');
      document.querySelectorAll('.nav-link').forEach(l => {
        l.classList.toggle('text-white', l.dataset.view === name);
        l.classList.toggle('bg-indigo-500/10', l.dataset.view === name);
        l.classList.toggle('text-slate-400', l.dataset.view !== name);
      });
      if (name === 'history') loadHistory();
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DRAG & DROP ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    function handleDragOver(e) {
      e.preventDefault();
      document.getElementById('drop-zone').classList.add('drag-over');
    }
    function handleDragLeave(e) {
      document.getElementById('drop-zone').classList.remove('drag-over');
    }
    function handleDrop(e) {
      e.preventDefault();
      document.getElementById('drop-zone').classList.remove('drag-over');
      const f = e.dataTransfer.files[0];
      if (f) processFile(f);
    }
    function handleFileSelect(input) {
      if (input.files[0]) processFile(input.files[0]);
    }

    function processFile(file) {
      const allowed = ['application/pdf',
        'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
        'application/msword'];
      if (!allowed.includes(file.type) && !file.name.match(/\.(pdf|docx|doc)$/i)) {
        showToast('error', 'Format Tidak Didukung', 'Gunakan file PDF atau DOCX/DOC.');
        return;
      }
      state.currentFile = file;
      document.getElementById('dz-idle').classList.add('hidden');
      document.getElementById('dz-selected').classList.remove('hidden');
      document.getElementById('selected-filename').textContent = file.name;
      document.getElementById('selected-filesize').textContent = formatFileSize(file.size);
      document.getElementById('btn-analyze').disabled = false;
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ANALYZE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    async function analyzeDocument() {
      if (!state.currentFile) return;
      showPanel('loading');
      setStep(2);
      await simulateLoadingSteps();

      const formData = new FormData();
      formData.append('file', state.currentFile);

      try {
        const res = await fetch('/upload', { method: 'POST', body: formData });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || 'Gagal menganalisis.');
        state.analysisResult = data.analysis;
        state.rawText        = data.raw_text_ref;
        renderResult(data);
        showPanel('result');
        setStep(3);
        showToast('success', 'Analisis Selesai', `${data.filename} berhasil diproses.`);
      } catch (err) {
        showPanel('upload');
        setStep(1);
        showToast('error', 'Error', err.message);
      }
    }

    async function simulateLoadingSteps() {
      const steps = ['lt-extract', 'lt-nlp', 'lt-entity', 'lt-sent', 'lt-summary'];
      const labels = ['Mengekstrak teks dari file...', 'Memproses NLP pipeline...', 'Mendeteksi named entities...', 'Menganalisis sentimen...', 'Menghasilkan ringkasan...'];
      for (let i = 0; i < steps.length; i++) {
        document.getElementById('loading-step-text').textContent = labels[i];
        const dot  = document.getElementById(`${steps[i]}-dot`);
        const text = document.getElementById(`${steps[i]}-text`);
        dot.classList.remove('bg-slate-600');
        dot.classList.add('bg-indigo-500', 'animate-ping');
        text.classList.remove('text-slate-500');
        text.classList.add('text-indigo-300');
        await sleep(600);
        dot.classList.remove('animate-ping', 'bg-indigo-500');
        dot.classList.add('bg-emerald-500');
        text.classList.remove('text-indigo-300');
        text.classList.add('text-emerald-300');
      }
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RENDER RESULT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    function renderResult(data) {
      const a = data.analysis;
      // Header
      document.getElementById('res-filename').textContent  = data.filename;
      document.getElementById('res-filetype').textContent  = data.file_type?.toUpperCase() || '‚Äî';
      document.getElementById('res-wordcount').textContent = `${(a.word_count||0).toLocaleString()} kata`;
      document.getElementById('res-charcount').textContent = `${(a.char_count||0).toLocaleString()} karakter`;
      document.getElementById('res-lang').textContent      = `üåê ${a.language || '‚Äî'}`;
      // Summary
      document.getElementById('res-summary').textContent = a.summary || 'Tidak ada ringkasan tersedia.';
      document.getElementById('res-preview').textContent = data.preview_text || '‚Äî';
      // Sentiment
      const sLabel = a.sentiment?.label || 'NEUTRAL';
      const sScore = a.sentiment?.score || 0;
      const sPos   = a.sentiment?.positive_count || 0;
      const sNeg   = a.sentiment?.negative_count || 0;
      const sTotal = Math.max(sPos + sNeg, 1);
      document.getElementById('res-sentiment-label').textContent = sLabel;
      document.getElementById('res-sentiment-label').className   = `text-white font-bold text-xl sentiment-${sLabel.toLowerCase()}`;
      document.getElementById('res-sentiment-score').textContent = `Confidence: ${Math.round(sScore * 100)}%`;
      document.getElementById('res-pos-count').textContent = sPos;
      document.getElementById('res-neg-count').textContent = sNeg;
      document.getElementById('res-pos-bar').style.width   = `${(sPos / sTotal) * 100}%`;
      document.getElementById('res-neg-bar').style.width   = `${(sNeg / sTotal) * 100}%`;
      const sentEmoji = { POSITIVE: 'üòä', NEGATIVE: 'üòû', NEUTRAL: 'üòê' };
      document.getElementById('sentiment-icon').textContent = sentEmoji[sLabel] || 'üòê';
      // Topics
      const topicsEl = document.getElementById('res-topics');
      const topicColors = ['bg-indigo-500/15 text-indigo-300 border-indigo-500/20',
        'bg-cyan-500/15 text-cyan-300 border-cyan-500/20',
        'bg-violet-500/15 text-violet-300 border-violet-500/20',
        'bg-emerald-500/15 text-emerald-300 border-emerald-500/20'];
      topicsEl.innerHTML = (a.topics || []).map((t, i) =>
        `<span class="tag border ${topicColors[i % topicColors.length]}">${t}</span>`
      ).join('') || '<span class="text-slate-500 text-sm">Tidak terdeteksi</span>';
      // Keywords
      const kwEl = document.getElementById('res-keywords');
      kwEl.innerHTML = (a.keywords || []).slice(0, 15).map(k =>
        `<span class="tag bg-slate-700/60 text-slate-300 border border-slate-600/50">${k}</span>`
      ).join('') || '<span class="text-slate-500 text-xs">‚Äî</span>';
      // Entities
      const entEl = document.getElementById('res-entities');
      const entColors = {
        PERSON: 'bg-rose-500/15 text-rose-300 border-rose-500/20',
        ORG: 'bg-amber-500/15 text-amber-300 border-amber-500/20',
        GPE: 'bg-blue-500/15 text-blue-300 border-blue-500/20',
        LOC: 'bg-teal-500/15 text-teal-300 border-teal-500/20',
        DATE: 'bg-violet-500/15 text-violet-300 border-violet-500/20',
        MONEY: 'bg-emerald-500/15 text-emerald-300 border-emerald-500/20',
        DEFAULT: 'bg-slate-700/60 text-slate-300 border-slate-600/50',
      };
      entEl.innerHTML = (a.entities || []).slice(0, 25).map(e => {
        const c = entColors[e.label] || entColors.DEFAULT;
        return `<span class="entity-badge border ${c}">${e.text} <sup class="opacity-60 text-[10px]">${e.label}</sup></span>`;
      }).join('') || '<span class="text-slate-500 text-sm">Tidak ada entitas terdeteksi.</span>';
      document.getElementById('res-entity-count').textContent = (a.entities || []).length;
      // Stats
      document.getElementById('stat-words').textContent    = (a.word_count||0).toLocaleString();
      document.getElementById('stat-chars').textContent    = (a.char_count||0).toLocaleString();
      document.getElementById('stat-entities').textContent = (a.entities||[]).length;
      document.getElementById('stat-keywords').textContent = (a.keywords||[]).length;
      document.getElementById('stat-lang').textContent     = a.language || '‚Äî';
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TABS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    function switchTab(name, el) {
      document.getElementById('tab-summary').classList.toggle('hidden', name !== 'summary');
      document.getElementById('tab-preview').classList.toggle('hidden', name !== 'preview');
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      el.classList.add('active');
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ACTION ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    function selectAction(action) {
      state.selectedAction = action;
      ['save', 'regen', 'save-regen'].forEach(a => {
        const el = document.getElementById(`opt-${a === 'save-regen' ? 'save-regen' : a}`);
        el.classList.toggle('border-indigo-500/60', action === a);
        el.classList.toggle('bg-indigo-500/10', action === a);
        el.classList.toggle('border-slate-700/50', action !== a);
      });
      // Show context box if regeneration involved
      document.getElementById('ctx-box').classList.toggle('hidden', action === 'save');
      const btnExecute = document.getElementById('btn-execute');
      const btnText    = document.getElementById('btn-execute-text');
      btnExecute.disabled = false;
      const labels = {
        'save':       'Simpan ke Database',
        'regen':      'Generate Ulang Analisis',
        'save-regen': 'Simpan & Generate Ulang',
      };
      const btnClasses = {
        'save':       'btn-success',
        'regen':      'btn-accent',
        'save-regen': 'btn-warning',
      };
      btnText.textContent = labels[action];
      btnExecute.className = `${btnClasses[action]} w-full mt-4 py-3.5 rounded-xl text-white font-semibold text-sm flex items-center justify-center gap-2`;
    }

    async function executeAction() {
      const action  = state.selectedAction;
      const context = document.getElementById('additional-context').value;
      if (!action || !state.rawText) return;

      const btn = document.getElementById('btn-execute');
      btn.disabled = true;
      btn.innerHTML = `<svg class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"></path></svg> Memproses...`;

      const body = {
        filename:           state.currentFile.name,
        file_type:          state.currentFile.name.split('.').pop().toLowerCase(),
        raw_text:           state.rawText,
        analysis:           state.analysisResult,
        additional_context: context,
      };

      const endpoints = {
        'save':       { url: '/documents/save',               method: 'POST' },
        'regen':      { url: '/documents/regenerate',         method: 'POST' },
        'save-regen': { url: '/documents/save-and-regenerate', method: 'POST' },
      };

      try {
        const { url } = endpoints[action];
        const res     = await fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(body),
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || 'Gagal.');

        // Show success
        document.getElementById('action-success').classList.remove('hidden');
        const msgs = {
          'save':       ['Berhasil Disimpan!',            `Document ID: ${data.document_id}`],
          'regen':      ['Regenerasi Selesai!',           'Analisis baru telah dihasilkan.'],
          'save-regen': ['Disimpan & Diregenerasi!',      `ID: ${data.document_id} ‚Äî ${data.regen_analysis_id}`],
        };
        document.getElementById('success-msg').textContent    = msgs[action][0];
        document.getElementById('success-detail').textContent = msgs[action][1];

        if (action === 'regen' || action === 'save-regen') {
          const regenData = action === 'regen' ? data.analysis : data.regenerated_analysis;
          if (regenData) {
            renderResult({ filename: state.currentFile.name, file_type: body.file_type, analysis: regenData, preview_text: state.rawText.slice(0, 500) });
          }
        }

        showToast('success', msgs[action][0], msgs[action][1]);
        btn.innerHTML = `<svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg> Selesai`;

      } catch (err) {
        showToast('error', 'Gagal', err.message);
        btn.disabled = false;
        btn.innerHTML = `<span>Coba lagi</span>`;
      }
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HISTORY ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    async function loadHistory() {
      const tbody = document.getElementById('history-tbody');
      tbody.innerHTML = `<tr><td colspan="6" class="px-6 py-10 text-center">
        <div class="shimmer h-4 rounded mx-auto w-1/2 mb-3"></div>
        <div class="shimmer h-4 rounded mx-auto w-1/3"></div>
      </td></tr>`;

      try {
        const res  = await fetch(`/documents?page=${state.historyPage}&per_page=10`);
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || 'Gagal memuat.');
        state.historyDocs  = data.documents;
        state.historyTotal = data.total;
        renderHistory(data.documents);
        document.getElementById('history-info').textContent =
          `Menampilkan ${data.documents.length} dari ${data.total} dokumen`;
        document.getElementById('btn-prev').disabled = data.page <= 1;
        document.getElementById('btn-next').disabled = data.page >= data.pages;
      } catch (err) {
        tbody.innerHTML = `<tr><td colspan="6" class="px-6 py-8 text-center text-slate-500">${err.message}</td></tr>`;
      }
    }

    function renderHistory(docs) {
      const tbody = document.getElementById('history-tbody');
      if (!docs.length) {
        tbody.innerHTML = `<tr><td colspan="6" class="px-6 py-12 text-center text-slate-500">
          <svg class="w-10 h-10 text-slate-700 mx-auto mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
            <path stroke-linecap="round" stroke-linejoin="round" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
          </svg>
          Belum ada dokumen tersimpan.</td></tr>`;
        return;
      }
      tbody.innerHTML = docs.map(d => `
        <tr class="border-b border-slate-800/50 hover:bg-indigo-500/5 transition-colors">
          <td class="px-6 py-4">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded-lg bg-indigo-500/10 border border-indigo-500/20 flex items-center justify-center flex-shrink-0">
                <svg class="w-4 h-4 text-indigo-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
              </div>
              <span class="text-white text-sm font-medium truncate max-w-[180px]">${d.filename}</span>
            </div>
          </td>
          <td class="px-6 py-4 hidden sm:table-cell">
            <span class="tag bg-indigo-500/15 text-indigo-300 border border-indigo-500/20">${d.file_type?.toUpperCase()}</span>
          </td>
          <td class="px-6 py-4 hidden md:table-cell text-slate-400 text-sm">${d.language || '‚Äî'}</td>
          <td class="px-6 py-4 hidden lg:table-cell text-slate-400 text-sm font-mono">${(d.word_count||0).toLocaleString()}</td>
          <td class="px-6 py-4 hidden lg:table-cell text-slate-500 text-xs">${formatDate(d.created_at)}</td>
          <td class="px-6 py-4 text-right">
            <div class="flex items-center justify-end gap-2">
              <button onclick="viewDocDetail(${d.id})"
                class="btn-ghost text-xs px-3 py-1.5 rounded-lg text-indigo-300">Detail</button>
              <button onclick="deleteDoc(${d.id})"
                class="btn-ghost text-xs px-3 py-1.5 rounded-lg text-rose-400 hover:text-rose-300">Hapus</button>
            </div>
          </td>
        </tr>
      `).join('');
    }

    function filterHistory(q) {
      const filtered = state.historyDocs.filter(d =>
        d.filename.toLowerCase().includes(q.toLowerCase()) ||
        (d.language||'').toLowerCase().includes(q.toLowerCase())
      );
      renderHistory(filtered);
    }

    function changePage(dir) {
      state.historyPage = Math.max(1, state.historyPage + dir);
      loadHistory();
    }

    async function viewDocDetail(id) {
      try {
        const res  = await fetch(`/documents/${id}`);
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || 'Gagal memuat detail.');
        const d = data.document;
        const a = data.analyses?.[0] || {};
        document.getElementById('modal-title').textContent = d.filename;
        document.getElementById('modal-content').innerHTML = `
          <div class="grid grid-cols-2 gap-3">
            <div class="glass rounded-xl p-3">
              <p class="text-slate-500 text-xs mb-1">Tipe</p>
              <p class="text-white font-medium">${d.file_type?.toUpperCase()}</p>
            </div>
            <div class="glass rounded-xl p-3">
              <p class="text-slate-500 text-xs mb-1">Bahasa</p>
              <p class="text-white font-medium">${d.language || '‚Äî'}</p>
            </div>
            <div class="glass rounded-xl p-3">
              <p class="text-slate-500 text-xs mb-1">Kata</p>
              <p class="text-white font-medium font-mono">${(d.word_count||0).toLocaleString()}</p>
            </div>
            <div class="glass rounded-xl p-3">
              <p class="text-slate-500 text-xs mb-1">Tanggal</p>
              <p class="text-white font-medium text-xs">${formatDate(d.created_at)}</p>
            </div>
          </div>
          ${a.summary ? `
          <div>
            <p class="text-slate-400 text-xs font-semibold uppercase tracking-wider mb-2">Ringkasan</p>
            <p class="text-slate-300 text-sm leading-relaxed">${a.summary}</p>
          </div>` : ''}
          ${(a.keywords||[]).length ? `
          <div>
            <p class="text-slate-400 text-xs font-semibold uppercase tracking-wider mb-2">Keywords</p>
            <div class="flex flex-wrap gap-1.5">${(a.keywords||[]).map(k => `<span class="tag bg-slate-700/60 text-slate-300 border border-slate-600/50 text-xs">${k}</span>`).join('')}</div>
          </div>` : ''}
          ${(a.topics||[]).length ? `
          <div>
            <p class="text-slate-400 text-xs font-semibold uppercase tracking-wider mb-2">Topik</p>
            <div class="flex flex-wrap gap-1.5">${(a.topics||[]).map(t => `<span class="tag bg-indigo-500/15 text-indigo-300 border border-indigo-500/20">${t}</span>`).join('')}</div>
          </div>` : ''}
          <div class="flex gap-3 pt-2">
            <span class="text-slate-500 text-xs">ID Dokumen: ${d.id}</span>
            <span class="text-slate-500 text-xs">Analisis: ${data.analyses?.length || 0}</span>
          </div>
        `;
        document.getElementById('modal-detail').classList.remove('hidden');
        document.getElementById('modal-detail').classList.add('flex');
      } catch (err) {
        showToast('error', 'Error', err.message);
      }
    }

    async function deleteDoc(id) {
      if (!confirm('Yakin ingin menghapus dokumen ini?')) return;
      try {
        const res = await fetch(`/documents/${id}`, { method: 'DELETE' });
        if (!res.ok) throw new Error('Gagal menghapus.');
        showToast('success', 'Dihapus', `Dokumen ID ${id} berhasil dihapus.`);
        loadHistory();
      } catch (err) {
        showToast('error', 'Error', err.message);
      }
    }

    function closeModal() {
      document.getElementById('modal-detail').classList.add('hidden');
      document.getElementById('modal-detail').classList.remove('flex');
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PANEL / STEP HELPERS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    function showPanel(name) {
      ['upload', 'loading', 'result'].forEach(p => {
        document.getElementById(`panel-${p}`).classList.toggle('hidden', p !== name);
      });
    }

    function setStep(n) {
      for (let i = 1; i <= 3; i++) {
        const el    = document.getElementById(`step-${i}`);
        const label = document.getElementById(`step-${i}-label`);
        if (i < n) {
          el.className = 'step-indicator completed';
          el.innerHTML = `<svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>`;
          label.className = 'text-sm font-medium text-emerald-300';
        } else if (i === n) {
          el.className = 'step-indicator active';
          el.textContent = i;
          label.className = 'text-sm font-medium text-white';
        } else {
          el.className = 'step-indicator pending';
          el.textContent = i;
          label.className = 'text-sm text-slate-500';
        }
      }
    }

    function resetUpload() {
      state.currentFile    = null;
      state.analysisResult = null;
      state.rawText        = null;
      state.selectedAction = null;
      document.getElementById('file-input').value = '';
      document.getElementById('dz-idle').classList.remove('hidden');
      document.getElementById('dz-selected').classList.add('hidden');
      document.getElementById('btn-analyze').disabled = true;
      document.getElementById('additional-context').value = '';
      document.getElementById('action-success').classList.add('hidden');
      document.getElementById('ctx-box').classList.add('hidden');
      // Reset loading steps
      ['lt-extract','lt-nlp','lt-entity','lt-sent','lt-summary'].forEach(id => {
        const dot  = document.getElementById(`${id}-dot`);
        const text = document.getElementById(`${id}-text`);
        dot.className  = 'w-2 h-2 rounded-full bg-slate-600';
        text.className = 'text-slate-500';
      });
      showPanel('upload');
      setStep(1);
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TOAST ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    let toastTimer;
    function showToast(type, title, msg) {
      const icons = {
        success: `<svg class="w-5 h-5 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>`,
        error:   `<svg class="w-5 h-5 text-rose-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>`,
        info:    `<svg class="w-5 h-5 text-indigo-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>`,
      };
      document.getElementById('toast-icon').innerHTML = icons[type] || icons.info;
      document.getElementById('toast-title').textContent = title;
      document.getElementById('toast-msg').textContent   = msg;
      const t = document.getElementById('toast');
      t.classList.add('show');
      clearTimeout(toastTimer);
      toastTimer = setTimeout(hideToast, 4000);
    }
    function hideToast() {
      document.getElementById('toast').classList.remove('show');
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê UTILITIES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    function formatFileSize(bytes) {
      if (bytes < 1024) return `${bytes} B`;
      if (bytes < 1048576) return `${(bytes / 1024).toFixed(1)} KB`;
      return `${(bytes / 1048576).toFixed(1)} MB`;
    }
    function formatDate(iso) {
      if (!iso) return '‚Äî';
      return new Date(iso).toLocaleDateString('id-ID', {
        day: '2-digit', month: 'short', year: 'numeric',
        hour: '2-digit', minute: '2-digit',
      });
    }
    function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê API HEALTH CHECK ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    async function checkHealth() {
      try {
        const res = await fetch('/health');
        document.getElementById('api-status').textContent = res.ok ? 'API Online' : 'API Error';
      } catch { document.getElementById('api-status').textContent = 'API Offline'; }
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    checkHealth();
    showView('upload');
  </script>
</body>
</html>